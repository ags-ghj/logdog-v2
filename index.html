<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>LogDog ‚Äî If you've seen a dog, add it to the log!!!</title>

<link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@600;800&family=Space+Grotesk:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0f1418;--panel:#141b21;--panel-2:#1b242c;
  --ink:#f4efe6;--muted:#a7b0b8;--accent:#f5a524;--stroke:#2a3640;
}
*{box-sizing:border-box}
body{margin:0;font-family:"Space Grotesk",sans-serif;color:var(--ink);background:var(--bg)}

header{padding:18px;text-align:center;border-bottom:1px solid var(--stroke)}
header h1{margin:0;font-family:"Fraunces",serif}
header p{margin:6px 0;color:var(--muted);font-size:14px}
.nav{display:flex;justify-content:center;gap:12px;margin-top:10px}
.nav a{padding:8px 14px;border-radius:20px;border:1px solid var(--stroke);color:var(--ink);text-decoration:none;font-size:13px}

.container{max-width:900px;margin:0 auto;padding:18px}
.card{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid var(--stroke);border-radius:16px;padding:18px}

.stats{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
  margin-bottom:16px
}
.stat{
  background:#101820;
  border:1px solid var(--stroke);
  border-radius:12px;
  padding:12px;
  text-align:center
}
.stat strong{display:block;font-size:20px}

label{display:block;margin-top:14px;font-size:12px;text-transform:uppercase;letter-spacing:.08em;color:var(--muted)}
input,textarea{width:100%;margin-top:6px;padding:12px;border-radius:12px;border:1px solid var(--stroke);background:#0f151a;color:var(--ink)}

.count-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:6px}
.count-btn{padding:12px;border-radius:10px;border:1px solid var(--stroke);background:#101820;color:var(--ink);font-weight:600;cursor:pointer}
.count-btn.active{outline:2px solid var(--accent)}

.geo-row{display:flex;gap:8px}
.geo-btn{padding:12px;border-radius:12px;border:1px solid var(--stroke);background:#101820;color:var(--ink);cursor:pointer}
.geo-btn span{font-size:18px}

button.primary{
  width:100%;margin-top:18px;padding:14px;border-radius:12px;border:none;
  font-weight:800;background:linear-gradient(120deg,var(--accent),#ffcf5a);
  color:#241600;cursor:pointer
}

hr{border:0;border-top:1px solid var(--stroke);margin:22px 0}

.table-wrap{overflow-x:auto;border-left:1px solid var(--stroke);border-right:1px solid var(--stroke)}
table{width:100%;min-width:720px;border-collapse:collapse;table-layout:fixed}
thead th{position:sticky;top:0;background:#141b21;z-index:2}

th,td{
  padding:10px;border-bottom:1px solid var(--stroke);
  font-size:14px;vertical-align:middle;white-space:normal
}
th{font-size:11px;color:var(--muted);text-transform:uppercase}

/* column alignment */
th:nth-child(1),td:nth-child(1){text-align:left}
th:nth-child(2),td:nth-child(2){text-align:left}
th:nth-child(3),td:nth-child(3){text-align:center}
th:nth-child(4),td:nth-child(4){text-align:left}
th:nth-child(5),td:nth-child(5){text-align:left}
th:nth-child(6),td:nth-child(6){text-align:center}

.photo-cell{width:80px}
img.thumb{width:44px;height:44px;border-radius:8px;object-fit:cover;cursor:pointer}

.note{max-height:2.6em;overflow:hidden;cursor:pointer}
.note.open{max-height:none}

tbody tr:hover{background:rgba(255,255,255,0.03)}

small{display:block;margin-top:6px;color:var(--muted)}
#status{font-size:14px;padding:8px 12px;border-radius:8px;text-align:center;min-height:20px}
#status:not(:empty){background:#1b242c;color:var(--accent);border:1px solid var(--stroke);font-weight:600}

@media(max-width:700px){
  table{min-width:700px}
  .stats{grid-template-columns:repeat(2,1fr)}
}

/* modal */
.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.8);
  display:none;align-items:center;justify-content:center;z-index:99
}
.modal img{max-width:90vw;max-height:90vh;border-radius:12px}
</style>
</head>

<body>

<header>
  <h1>LogDog üêï</h1>
  <p>If you've seen a dog, you must add it to the log!!!</p>
  <p>&nbsp;</p>
  <div class="nav">
    <a href="index.html">Home</a>
    <a href="logs.html">View stats</a>
  </div>
</header>

<div class="container">
<div class="card">

<div class="stats">
  <div class="stat"><strong id="sToday">0</strong>Today</div>
  <div class="stat"><strong id="sYest">0</strong>Yesterday</div>
  <div class="stat"><strong id="sDogs">0</strong>Dogs</div>
  <div class="stat"><strong id="sLogs">0</strong>Logs</div>
</div>

<label>Breed</label>
<input id="breed" list="breedList">
<datalist id="breedList">
  <option>Labrador Retriever</option>
  <option>Golden Retriever</option>
  <option>German Shepherd</option>
  <option>French Bulldog</option>
  <option>Border Collie</option>
  <option>Mixed / Cross</option>
  <option>Afghan Hound</option>
  <option>Airedale Terrier</option>
  <option>Akita</option>
  <option>Alaskan Malamute</option>
  <option>American Bulldog</option>
  <option>American Eskimo Dog</option>
  <option>American Pit Bull Terrier</option>
  <option>American Staffordshire Terrier</option>
  <option>Australian Cattle Dog</option>
  <option>Australian Shepherd</option>
  <option>Australian Terrier</option>
  <option>Basenji</option>
  <option>Basset Hound</option>
  <option>Beagle</option>
  <option>Bearded Collie</option>
  <option>Belgian Malinois</option>
  <option>Belgian Sheepdog</option>
  <option>Belgian Shepherd</option>
  <option>Belgian Tervuren</option>
  <option>Bernese Mountain Dog</option>
  <option>Bichon Frise</option>
  <option>Bloodhound</option>
  <option>Borzoi</option>
  <option>Boston Terrier</option>
  <option>Boxer</option>
  <option>Brittany</option>
  <option>Bull Terrier</option>
  <option>Bullmastiff</option>
  <option>Cairn Terrier</option>
  <option>Cane Corso</option>
  <option>Cavalier King Charles Spaniel</option>
  <option>Chesapeake Bay Retriever</option>
  <option>Chihuahua</option>
  <option>Chinese Crested</option>
  <option>Chow Chow</option>
  <option>Collie</option>
  <option>Coton de Tulear</option>
  <option>Dachshund</option>
  <option>Doberman Pinscher</option>
  <option>English Bulldog</option>
  <option>English Cocker Spaniel</option>
  <option>English Pointer</option>
  <option>English Springer Spaniel</option>
  <option>Field Spaniel</option>
  <option>Finnish Spitz</option>
  <option>Flat-Coated Retriever</option>
  <option>German Shorthaired Pointer</option>
  <option>German Wirehaired Pointer</option>
  <option>Great Dane</option>
  <option>Great Pyrenees</option>
  <option>Greyhound</option>
  <option>Havanese</option>
  <option>Irish Setter</option>
  <option>Irish Terrier</option>
  <option>Irish Wolfhound</option>
  <option>Italian Greyhound</option>
  <option>Jack Russell Terrier</option>
  <option>Keeshond</option>
  <option>Komondor</option>
  <option>Kuvasz</option>
  <option>Leonberger</option>
  <option>Lhasa Apso</option>
  <option>Maltese</option>
  <option>Miniature Bull Terrier</option>
  <option>Miniature Schnauzer</option>
  <option>Mongrel</option>
  <option>Newfoundland</option>
  <option>Norfolk Terrier</option>
  <option>Norwich Terrier</option>
  <option>Nova Scotia Duck Tolling Retriever</option>
  <option>Old English Sheepdog</option>
  <option>Papillon</option>
  <option>Pembroke Welsh Corgi</option>
  <option>Pomeranian</option>
  <option>Poodle</option>
  <option>Portuguese Water Dog</option>
  <option>Pug</option>
  <option>Rhodesian Ridgeback</option>
  <option>Rottweiler</option>
  <option>Rough Collie</option>
  <option>Russell Terrier</option>
  <option>Saint Bernard</option>
  <option>Saluki</option>
  <option>Samoyed</option>
  <option>Scottish Terrier</option>
  <option>Shar-Pei</option>
  <option>Shetland Sheepdog</option>
  <option>Shiba Inu</option>
  <option>Shih Tzu</option>
  <option>Siberian Husky</option>
  <option>Smooth Collie</option>
  <option>Soft Coated Wheaten Terrier</option>
  <option>Staffordshire Bull Terrier</option>
  <option>Tibetan Mastiff</option>
  <option>Tibetan Terrier</option>
  <option>Vizsla</option>
  <option>Weimaraner</option>
  <option>West Highland White Terrier</option>
  <option>Whippet</option>
  <option>Xoloitzcuintli</option>
  <option>Yorkshire Terrier</option>
</datalist>

<label>Count</label>
<div class="count-grid" id="countGrid">
  <button class="count-btn active" data-count="1">1</button>
  <button class="count-btn" data-count="2">2</button>
  <button class="count-btn" data-count="3">3</button>
  <button class="count-btn" data-count="4">4</button>
  <button class="count-btn" data-count="10">More</button>
</div>
<input id="count" type="hidden" value="1">

<label>Location</label>
<div class="geo-row">
  <input id="location">
  <button class="geo-btn" id="geoBtn"><span>üìç</span></button>
</div>

<label>Notes</label>
<textarea id="notes" rows="2"></textarea>

<label>Photo</label>
<input id="photo" type="file" accept="image/*">
<small id="photoName"></small>

<button class="primary" id="submitBtn">Submit</button>
<small id="status"></small>

<hr>
<p>&nbsp;</p>
<h2>Recent history</h2>

<div class="table-wrap">
<table>
<colgroup>
  <col style="width:150px">
  <col style="width:180px">
  <col style="width:50px">
  <col style="width:220px">
  <col>
  <col style="width:80px">
</colgroup>
<thead>
<tr>
  <th>Time</th><th>Breed</th><th>#</th><th>Location</th><th>Notes</th><th>Photo</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>
</div>

</div>
</div>

<div class="modal" id="modal" onclick="this.style.display='none'">
  <img id="modalImg">
</div>

<script>
const API=location.hostname==="localhost" || location.hostname==="127.0.0.1"
  ? "http://localhost:7071/api"
  : "https://fn-logdog2-cddwend9gva2gxa8.westeurope-01.azurewebsites.net/api";
const LAST_LOC="logdog_last_location";

const rowsEl=document.getElementById("rows");
const modal=document.getElementById("modal");
const modalImg=document.getElementById("modalImg");

const locationInput = document.getElementById("location");

photo.addEventListener("change",e=>{
  photoName.textContent=e.target.files[0]?.name||"";
});

geoBtn.onclick = () => {
  if (!navigator.geolocation) {
    status.textContent = "Location not supported";
    return;
  }

  status.textContent = "Getting location‚Ä¶";

  navigator.geolocation.getCurrentPosition(
    p => {
      const loc = `${p.coords.latitude.toFixed(5)}, ${p.coords.longitude.toFixed(5)}`;
      locationInput.value = loc;          // ‚úÖ guaranteed
      localStorage.setItem(LAST_LOC, loc);
      status.textContent = "Location added";
      geoBtn.style.outline = "2px solid var(--accent)";
      setTimeout(() => geoBtn.style.outline = "", 1200);    
    },
    err => {
      status.textContent = "Location denied ‚Äî tap again to retry";
    },
    { enableHighAccuracy: true, timeout: 10000 }
  );
  
};

countGrid.onclick=e=>{
  const b=e.target.closest(".count-btn");
  if(!b)return;
  document.querySelectorAll(".count-btn").forEach(x=>x.classList.remove("active"));
  b.classList.add("active");
  count.value=b.dataset.count;
};

submitBtn.onclick=submitLog;

function fmt(ts){
  return new Date(ts).toLocaleString(undefined,{weekday:"short",day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"});
}

async function compressImage(file){
  return new Promise((resolve)=>{
    const reader=new FileReader();
    reader.onload=e=>{
      const img=new Image();
      img.onload=()=>{
        const canvas=document.createElement("canvas");
        let w=img.width,h=img.height;
        const maxSize=1200;
        if(w>h){if(w>maxSize){h*=maxSize/w;w=maxSize}}
        else{if(h>maxSize){w*=maxSize/h;h=maxSize}}
        canvas.width=w;canvas.height=h;
        canvas.getContext("2d").drawImage(img,0,0,w,h);
        canvas.toBlob(resolve,"image/jpeg",0.7);
      };
      img.src=e.target.result;
    };
    reader.readAsDataURL(file);
  });
}

async function submitLog(){
  status.textContent="Saving‚Ä¶";
  let photoUrl="";
  if(photo.files.length){
    status.textContent="Compressing photo‚Ä¶";
    const compressed=await compressImage(photo.files[0]);
    const fd=new FormData();fd.append("file",compressed,"photo.jpg");
    status.textContent="Uploading photo‚Ä¶";
    photoUrl=await fetch(API+"/upload",{method:"POST",body:fd}).then(r=>r.text());
  }
  status.textContent="Saving log‚Ä¶";
  await fetch(API+"/submit",{method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify({breed:breed.value,count:+count.value,location:location.value,notes:notes.value,photoUrl})
  });
  notes.value="";photo.value="";photoName.textContent="";
  status.textContent="Done!";
  setTimeout(()=>status.textContent="",2000);
  load();
}

async function load(){
  if(localStorage.getItem(LAST_LOC))location.value=localStorage.getItem(LAST_LOC);
  const data=await fetch(API+"/logs").then(r=>r.json());
  rowsEl.innerHTML="";
  let dogs=0,today=0,yest=0;
  const d0=new Date();d0.setHours(0,0,0,0);
  const d1=new Date(d0);d1.setDate(d1.getDate()-1);

  data.forEach(x=>{
    const t=new Date(x.ts);
    dogs+=+x.count||1;
    if(t>=d0)today+=+x.count||1;
    if(t>=d1&&t<d0)yest+=+x.count||1;

    rowsEl.innerHTML+=`
    <tr>
      <td>${fmt(x.ts)}</td>
      <td>${x.breed||""}</td>
      <td>${x.count||""}</td>
      <td>${x.location||""}</td>
      <td class="note" onclick="this.classList.toggle('open')">${x.notes||""}</td>
      <td class="photo-cell">${x.photoUrl?`<img class="thumb" src="${x.photoUrl}" onclick="openImg('${x.photoUrl}')">`:""}</td>
    </tr>`;
  });

  sToday.textContent=today;
  sYest.textContent=yest;
  sDogs.textContent=dogs;
  sLogs.textContent=data.length;
}
function openImg(src){modalImg.src=src;modal.style.display="flex"}
load();
</script>

</body>
</html>
